@model IEnumerable<CanteenRFID.Web.Models.ReaderStatusViewModel>
<h2>Reader</h2>
@if(TempData["ApiKey"] != null){<div class="alert alert-success">Neuer API Key: <code>@TempData["ApiKey"]</code></div>}
@if(TempData["Info"] != null){<div class="alert alert-info">@TempData["Info"]</div>}
<a class="btn btn-success mb-3" href="/Readers/Create">Neu</a>
<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Standort</th>
            <th>Status</th>
            <th>Letzter Kontakt</th>
            <th>Display-Passwort</th>
            <th>Aktiv</th>
            <th class="text-end">Aktionen</th>
        </tr>
    </thead>
    <tbody>
    @foreach(var r in Model){
        <tr>
            <td>@r.Reader.ReaderId</td><td>@r.Reader.Name</td><td>@r.Reader.Location</td>
            <td class="align-middle">
                @if (r.IsOnline())
                {
                    <span class="badge bg-success">Online</span>
                }
                else
                {
                    <span class="badge bg-secondary">Offline</span>
                }
            </td>
            <td class="align-middle text-nowrap">
                <span class="small text-muted">@(r.LastSeenUtc?.ToLocalTime().ToString("dd.MM.yyyy HH:mm:ss") ?? "-")</span>
            </td>
            <td class="align-middle">
                <div class="d-flex flex-column gap-1">
                    <span class="small text-muted">@(string.IsNullOrWhiteSpace(r.Reader.DisplayPassword) ? "-" : r.Reader.DisplayPassword)</span>
                    <form method="post" asp-action="UpdateDisplayPassword" asp-route-id="@r.Reader.Id" class="d-flex gap-2">
                        @Html.AntiForgeryToken()
                        <input type="text" name="displayPassword" class="form-control form-control-sm" placeholder="Neues Passwort" />
                        <button class="btn btn-sm btn-outline-primary" type="submit">Speichern</button>
                    </form>
                </div>
            </td>
            <td>@(r.Reader.IsActive?"Ja":"Nein")</td>
            <td class="text-end d-flex gap-2 justify-content-end">
                <form method="post" asp-action="Toggle" asp-route-id="@r.Reader.Id">
                    @Html.AntiForgeryToken()
                    <button class="btn btn-sm @(r.Reader.IsActive ? "btn-outline-secondary" : "btn-outline-success")" type="submit">@(r.Reader.IsActive ? "Deaktivieren" : "Aktivieren")</button>
                </form>
                <form method="post" asp-action="Regenerate" asp-route-id="@r.Reader.Id" onsubmit="return confirm('API Key neu generieren?');">
                    @Html.AntiForgeryToken()
                    <button class="btn btn-sm btn-warning" type="submit">API Key regenerieren</button>
                </form>
                <form method="post" asp-action="Delete" asp-route-id="@r.Reader.Id" onsubmit="return confirm('Reader löschen?');">
                    @Html.AntiForgeryToken()
                    <button class="btn btn-sm btn-danger" type="submit">Löschen</button>
                </form>
            </td>
        </tr>
    }
    </tbody>
</table>
